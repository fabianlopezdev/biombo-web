---
import BaseLayout from '@/layouts/shared/BaseLayout.astro'
import TwoColumnLayout from '@/components/shared/TwoColumnLayout.astro'
import AboutUsSliderSection from '@/components/pages/about/AboutUsSliderSection.astro'
import { fetchAboutUsPageByLocale } from '@/shared/lib/sanity/queries/aboutUsPageQueries'
import type { AboutUsPage } from '@/shared/schemas/sanity/aboutUsPageSchema'
import {
  portableTextToHtml,
  portableTextToHtmlForPageSection,
} from '@/shared/lib/sanity/utils/portableTextToHtml'

// This is the Spanish about us page
const locale = 'es'

// Fetch about us page data from Sanity
let aboutUsPageData: AboutUsPage | null = null

try {
  aboutUsPageData = await fetchAboutUsPageByLocale(locale)
} catch {
  // Error fetching about us page data
}

const descriptionHtml = portableTextToHtmlForPageSection(aboutUsPageData?.description)
---

<BaseLayout
  title={aboutUsPageData?.title || 'Nosotros'}
  metaDescription={aboutUsPageData?.description?.[0]?.children?.[0]?.text}
>
  <main>
    <TwoColumnLayout>
      <h1 slot="first-column">{aboutUsPageData?.title || 'Nosotros'}</h1>
      <div slot="second-column" class="content-wrapper">
        {
          descriptionHtml ? (
            <p set:html={descriptionHtml} />
          ) : (
            <p>
              Biombo Studio es un estudio de diseño gráfico y web liderado por Jordi Daví.
              <br />
              <br />
              Contamos con una red de colaboradores, expertos en diversas disciplinas, que aportan
              su conocimiento para garantizar resultados de primer nivel.
              <br />
              <br />
              Trabajamos con el objetivo de encontrar el mejor camino creativo para tu proyecto,
              marca o empresa.
            </p>
          )
        }
      </div>
    </TwoColumnLayout>

    <!-- About Slider Section (if data exists) -->
    {
      aboutUsPageData?.aboutSlider && (
        <TwoColumnLayout class="about-slider-section">
          <h2 slot="first-column">{aboutUsPageData.aboutSlider.title}</h2>
          <div slot="second-column">
            <p set:html={portableTextToHtml(aboutUsPageData.aboutSlider.description)} />
            <AboutUsSliderSection sliderData={aboutUsPageData.aboutSlider} />
          </div>
        </TwoColumnLayout>
      )
    }
  </main>
</BaseLayout>

<style>
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    font-size: clamp(3rem, 2.305rem + 2.85vi, 5rem);
    letter-spacing: -0.04em;
    font-weight: var(--font-weight-semibold);
    /* line-height: 1; */
  }

  p {
    font-size: clamp(1.125rem, 0.691rem + 1.781vi, 2.375rem);
    line-height: 1.2;
    padding-block-start: 1.2rem;
    letter-spacing: -0.04em;
  }

  h2 {
    font-size: clamp(2rem, 1.435rem + 2.318vi, 3.625rem);
    letter-spacing: -0.04em;
    font-weight: var(--font-weight-semibold);
  }

  .about-slider-section {
    margin-block-start: 4rem;
  }
</style>
