---
import ProjectesLayout from '@/layouts/ProjectesLayout.astro'
import PillButton from '@/components/shared/PillButton.astro'
// This is the root index.astro file (Catalan)

const projectsFilters = [
  { name: 'Disseny gràfic', category: 'graphic-design' },
  { name: 'Disseny i desenvolupament web', category: 'web-design' },
  { name: 'Brànding i Identitat Corporativa', category: 'branding' },
  { name: 'Il·lustració', category: 'illustration' },
]
---

<ProjectesLayout pageTitle="Projectes">
  <section class="projects-filter-container">
    <h2>Filtrar per:</h2>
    <nav class="projects-nav-filter">
      <ul class="projects-filter-list">
        {
          projectsFilters.map((filter) => (
            <li>
              <PillButton
                text={filter.name}
                data-category={filter.category}
                class="filter-pill"
              />
            </li>
          ))
        }
      </ul>
      <button class="delete-filters">Borrar filtres</button>
    </nav>
  </section>
  <section class="projects-container">
    <nav>
      <ul class="projects-grid-container">
        <li>
          <article class="project">
            <a href="#">
              <img src="../../public/projects-mock.jpg" alt="">
            </a>
            <div class="project-caption">
              <figcaption class="caption-text">
                Projecte 1
              </figcaption>
            </div>
          </article>
        </li>
        <li>
          <article class="project">
            <a href="#">
              <img src="../../public/projects-mock.jpg" alt="">
            </a>
            <div class="project-caption">
              <figcaption class="caption-text">
                Projecte 1
              </figcaption>
            </div>
          </article>
        </li>
        <li>
          <article class="project">
            <a href="#">
              <img src="../../public/projects-mock.jpg" alt="">
            </a>
            <div class="project-caption">
              <figcaption class="caption-text">
                Projecte 1
              </figcaption>
            </div>
          </article>
        </li>
      </ul>
    </nav>
  </section>
</ProjectesLayout>

<style>
  .projects-filter-container {
    --projects-text-size: clamp(1.125rem, 1.082rem + 0.178vi, 1.25rem);
    padding-block-start: var(--padding-block);
    display: flex;
    align-items: center;
    gap: 1.25rem;
  }
  h2 {
    font-size: var(--projects-text-size);
    font-weight: var(--font-weight-light);
  }
  .projects-nav-filter {
    display: flex;
    align-items: center;
    gap: 1.25rem;
    flex: 1;
    padding-block-end: clamp(1.625rem, 1.321rem + 1.247vi, 2.5rem);
  }
  .projects-filter-list {
    list-style: none;
    display: flex;
    flex-wrap: wrap;
    gap: clamp(0.625rem, 0.582rem + 0.178vi, 0.75rem);
    cursor: grab;
  }

  .delete-filters {
    margin-inline-start: auto;
    font-size: var(--projects-text-size);
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  .projects-grid-container {
    max-width: 85.3125rem;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 300px), 1fr));
    margin-inline: auto;
    gap: 1.85rem;
  }

  .project {
   height: clamp(25.375rem, -2.75rem + 41.705vi, 36.688rem);
   overflow: hidden;
   border-radius: 0.621875rem;
   
  }

  .project img {
    height: 100%;
    width: 100%;
    object-fit: cover;
    display: block;
    /* object-position: right center; */
  }

  @media (width < 992px) {
    .projects-filter-container {
      flex-direction: column;
      align-items: flex-start;
      gap: 1.125rem;
    }
    .projects-nav-filter {
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      margin-inline: calc(-1 * var(--padding-inline));
      width: 100vw;
      display: flex;
      align-items: center;
      gap: clamp(0.625rem, 0.582rem + 0.178vi, 0.75rem);
      padding-block: 4px;
    }
    .projects-nav-filter::-webkit-scrollbar {
      display: none;
    }
    .projects-filter-list {
      flex-wrap: nowrap;
      padding-inline-start: var(--padding-inline);
    }

    .projects-filter-list:active {
      cursor: grabbing;
    }
    .delete-filters {
      margin-inline-start: 0;
      flex-shrink: 0;
      padding-inline-start: 1rem;
      padding-inline-end: var(--padding-inline);
    }
  }
</style>

<script>
  const filterNav = document.querySelector('.projects-nav-filter') as HTMLElement

  if (filterNav) {
    let isDown = false
    let startX: number
    let scrollLeft: number

    filterNav.addEventListener('mousedown', (e) => {
      isDown = true
      filterNav.style.cursor = 'grabbing'
      startX = e.pageX - filterNav.offsetLeft
      scrollLeft = filterNav.scrollLeft
    })

    filterNav.addEventListener('mouseleave', () => {
      isDown = false
      filterNav.style.cursor = 'grab'
    })

    filterNav.addEventListener('mouseup', () => {
      isDown = false
      filterNav.style.cursor = 'grab'
    })

    filterNav.addEventListener('mousemove', (e) => {
      if (!isDown) return
      e.preventDefault()
      const x = e.pageX - filterNav.offsetLeft
      const walk = (x - startX) * 2 // Scroll speed multiplier
      filterNav.scrollLeft = scrollLeft - walk
    })

    // Prevent link clicks when dragging
    const links = filterNav.querySelectorAll('a')
    links.forEach((link) => {
      link.addEventListener('click', (e) => {
        if (filterNav.scrollLeft !== scrollLeft) {
          e.preventDefault()
        }
      })
    })

    // Set initial cursor
    filterNav.style.cursor = 'grab'
  }
</script>
