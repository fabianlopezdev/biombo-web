---
import ProjectMobileInfo from '@/components/shared/ProjectMobileInfo.astro'
import OptimizedImage from '@/components/shared/OptimizedImage.astro'
import OptimizedVideo from '@/components/shared/OptimizedVideo.astro'
import type { FileWithResolvedAsset } from '@/lib/sanity/schemas/projectSchema'
import { isVideoFile } from '@/helpers/projects/projectHelpers'
import { getProjectUrl } from '@/config/i18n/projects'

export interface ProjectCardProps {
  slug?: string
  projectNumber: number
  hoverColor?: string
  textHoverColor?: string
  image?: string
  imageObject?: any
  alt?: string
  title?: string
  clients?: string
  loading?: 'eager' | 'lazy'
  locale?: 'ca' | 'es' | 'en'
}

const {
  slug,
  projectNumber,
  hoverColor = 'transparent',
  textHoverColor = 'inherit',
  image,
  imageObject,
  alt,
  title,
  clients,
  loading = 'lazy',
  locale = 'ca',
} = Astro.props as ProjectCardProps

// Detect if the media is a video
const isVideo = imageObject && isVideoFile(imageObject as FileWithResolvedAsset)
---

{
  image ? (
    <a
      href={slug ? getProjectUrl(slug, locale) : '#'}
      class={`project-mobile project-mobile-${projectNumber}`}
      style={`--hover-bg-color: ${hoverColor}; --hover-text-color: ${textHoverColor};`}
    >
      <div class="project-image-wrapper">
        {isVideo ? (
          <OptimizedVideo video={imageObject as FileWithResolvedAsset} class="project-image" />
        ) : (
          <OptimizedImage
            src={image}
            alt={alt || title || `Project ${projectNumber}`}
            image={imageObject}
            class="project-image"
            loading={loading}
            skipDimensions
          />
        )}
      </div>
      <ProjectMobileInfo title={title || `Project ${projectNumber}`} subtitle={clients} />
    </a>
  ) : null
}

<style>
  .project-mobile {
    display: flex;
    flex-direction: column;
    gap: 1.125rem;
    text-decoration: none;
    color: inherit;
    transition: transform 0.3s ease;
    flex: 0 0 auto;
    scroll-snap-align: start;
    width: min(72.3vw, 19.43rem);
  }

  .project-mobile:active {
    transform: scale(0.98);
  }

  .project-image-wrapper {
    width: 100%;
    aspect-ratio: 282 / 384.9;
    border-radius: 0.75rem;
    overflow: hidden;
    background-color: var(--hover-bg-color);
  }

  .project-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }
</style>
