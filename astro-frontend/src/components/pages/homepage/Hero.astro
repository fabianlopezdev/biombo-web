---
import HighlightScribble from '@/assets/HighlightScribble.astro'
import ScrollPill from '@/assets/ScrollPill.astro'
import { splitBoldSegments } from '@/utils/pages/homepage/parseBoldMarkdown'
import type { HomePage } from '@/shared/schemas/sanity/homePageSchema'

interface Props {
  heroData: HomePage['hero'] | Record<string, never> // HomePage['hero'] is SanityHeroSectionType | null
}

const { heroData } = Astro.props

console.log('heroData', heroData)

const {
  before: beforeHighlight,
  bold: highlightedWord,
  after: afterHighlight,
} = splitBoldSegments(heroData?.heroText)

const scrollText = heroData?.scrollText
---

<script src="@/scripts/pages/homepage/heroScroll.ts"></script>
<script src="@/scripts/pages/homepage/heroAnimation.ts"></script>

<h1 id="hero-title" data-animation="pending">
  {beforeHighlight}
  <span class="highlight-wrapper">
    <span class="highlight-text">{highlightedWord}</span>
    <HighlightScribble />
  </span>
  {afterHighlight}
</h1>
<button class="scroll-indicator bottom-left">
  <ScrollPill />

  <p class="label-wrapper">
    <span class="label-main">{scrollText}</span>
    <span aria-hidden="true" class="label-hover">{scrollText}</span>
  </p>
</button>

<style is:global>
  /* Hero animation styles - global to work with dynamically created elements */
  #hero-title[data-animation='pending'] {
    visibility: hidden;
  }

  #hero-title[data-animation='ready'],
  #hero-title[data-animation='active'] {
    visibility: visible;
  }

  /* Line animation styles */
  .hero-line {
    display: block !important;
    overflow: hidden !important;
    position: relative !important;
    line-height: inherit !important;
  }

  .hero-line-inner {
    display: inline-block !important;
    transform: translate3d(0, 100%, 0) !important;
    will-change: transform !important;
  }

  /* Animation triggered state */
  [data-animation='active'] .hero-line-inner {
    transform: translate3d(0, 0, 0) !important;
    transition: transform 1.5s cubic-bezier(0.19, 1, 0.22, 1) !important;
  }

  [data-animation='active'] .hero-line-inner[style*='--line-index'] {
    transition-delay: calc(750ms + var(--line-index, 0) * 200ms) !important;
  }

  /* Ensure highlight wrapper maintains proper sizing within animated lines */
  .hero-line .highlight-wrapper {
    display: inline !important;
    position: relative !important;
  }

  /* Respect reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .hero-line-inner {
      transform: translate3d(0, 0, 0) !important;
      transition: none !important;
    }
  }
</style>

<style>
  h1 {
    font-size: 8.65rem;
    letter-spacing: -0.05em;
    font-weight: var(--font-weight-semibold);
    line-height: 1.03;
    padding-block-end: 3rem;
    gap: 0.4em;

    .highlight-text {
      position: relative;
      z-index: 2;
    }

    &:hover .highlight-svg {
      scale: 1.05;
    }
  }

  .highlight-wrapper {
    position: relative;
    display: inline-block;
  }

  .scroll-indicator {
    display: flex;
    align-items: center;
    gap: 1.375rem;

    &:hover .label-main,
    &:focus-within .label-main {
      transform: translateY(-100%);
    }

    &:hover .label-hover,
    &:focus-within .label-hover {
      transform: translateY(0);
    }
  }
</style>
