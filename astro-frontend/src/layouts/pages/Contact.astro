---
import InternalPageLayout from '@/layouts/shared/InternalPageLayout.astro'
import ContactForm from '@/components/pages/contact/ContactForm.astro'
import ContactStudio from '@/components/pages/contact/ContactStudio.astro'
import { fetchContactPageByLocale } from '@/lib/sanity/queries/contactPageQueries'
import type { ContactPage } from '@/lib/sanity/schemas/contactPageSchema'
import { getPageMetadata } from '@/config/i18n/pageMetadata'

const { locale } = Astro.props

let contactPageData: ContactPage | null = null

try {
  contactPageData = await fetchContactPageByLocale(locale)
} catch (error) {
  console.error('Error fetching contact page data:', error)
}

const title = contactPageData?.title || 'Contacte'
const email = contactPageData?.email || 'info@biombo.cat'
const phone = contactPageData?.phone || '+(34) 699 696 969'
const metadata = getPageMetadata('contact', locale)

// Use Sanity SEO fields with fallback to static metadata
const pageMetaTitle = contactPageData?.metaTitle || metadata.title
const pageMetaDescription = contactPageData?.metaDescription || metadata.description
---

<InternalPageLayout
  pageMetaTitle={pageMetaTitle}
  pageMetaDescription={pageMetaDescription}
  pageTitle={title}
>
  <div slot="two-column-content" class="contact-content">
    <ContactStudio email={email} phone={phone} />
    <ContactForm formSection={contactPageData?.formSection} locale={locale} />
  </div>
</InternalPageLayout>

<style>
  .contact-content {
    width: 100%;
  }
</style>
