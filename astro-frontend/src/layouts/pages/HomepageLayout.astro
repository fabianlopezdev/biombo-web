---
import BaseLayout from '@/layouts/shared/BaseLayout.astro'
import type { HomePage } from '@/lib/sanity/schemas/homePageSchema'
import { fetchHomePageByLocale } from '@/lib/sanity/queries/homePageQueries'
import Projects, {
  type ResolvedProjectsSectionData,
} from '@/components/pages/homepage/projects-section/Projects.astro'
import Hero from '@/components/pages/homepage/Hero.astro'
import ProjectsMobile from '@/components/pages/homepage/projects-section/ProjectsMobile.astro'
import About from '@/components/pages/homepage/about-section/About.astro'
import Services from '@/components/shared/header/Services.astro'
import Clients from '@/components/shared/Clients.astro'

// About component fetches its own data based on locale

interface Props {
  locale: 'ca' | 'es' | 'en'
}

const { locale } = Astro.props

// Fetch homepage data from Sanity
let homePageData: HomePage | null = null

try {
  homePageData = await fetchHomePageByLocale(locale)
} catch (error) {
  console.error('Error fetching homepage data:', error)
}

const pageTitle = 'Biombo - Art, Events, Community'
---

<script src="@/scripts/wheel-to-horizontal-scroll.ts"></script>

<BaseLayout title={pageTitle}>
  <main id="main" class="main-content">
    <div class="horizontal-scroll-container" id="horizontal-container">
      <section class="hero">
        <Hero locale={locale} heroData={homePageData?.hero} />
      </section>

      <section id="projects" class="projects">
        <Projects
          projectsData={homePageData?.projects as ResolvedProjectsSectionData}
          locale={locale}
        />
      </section>
    </div>

    <section class="projects-mobile">
      <ProjectsMobile
        projectsData={homePageData?.projects as ResolvedProjectsSectionData}
        locale={locale}
      />
    </section>
    <About sectionData={homePageData?.about} />
    <Services servicesData={homePageData?.services} />
    <Clients clientsData={homePageData?.clients} />
  </main>
</BaseLayout>

<style>
  .horizontal-scroll-container {
    block-size: calc(100vh - var(--header-height));
    margin-block-start: var(--header-height);
    display: flex;
    overflow-x: auto;
    overscroll-behavior-x: contain;
    -webkit-overflow-scrolling: touch;
    /* scroll-snap-type: x proximity; */
  }

  .horizontal-scroll-container > section {
    flex: 0 0 100vw;
    block-size: inherit;
    /* scroll-snap-align: start; */
  }

  .hero {
    padding-inline: var(--padding-inline);
    display: flex;
    align-items: center;
    position: relative;
  }

  .projects {
    flex: 0 0 183.3vw !important;
  }

  .projects-mobile {
    display: none;
  }

  /* Disable horizontal scrolling on screens smaller than 992px */
  @media (width < 1025px) {
    .horizontal-scroll-container {
      block-size: auto;
      display: block;
      overflow-x: visible;
      overflow-y: visible;
      overscroll-behavior-x: initial;
      -webkit-overflow-scrolling: initial;
    }

    .horizontal-scroll-container > section {
      flex: initial;
      block-size: auto;
      width: 100%;
    }

    .projects {
      display: none;
    }

    .projects-mobile {
      display: block;
    }
  }
</style>
